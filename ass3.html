<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>kamal - E-Commerce Demo</title>
  <style>
    /* ========== Basic Reset & Layout ========== */
    *{box-sizing:border-box;margin:0;padding:0;font-family:Inter,Segoe UI,Roboto,'Noto Sans Tamil',sans-serif}
    body{background:#f4f6fb;color:#111;line-height:1.4;min-height:100vh;display:flex;flex-direction:column}
    .container{max-width:1100px;margin:24px auto;padding:16px}

    /* ========== Navbar ========== */
    header{background:#0b63d6;color:#fff;padding:12px 0;box-shadow:0 2px 6px rgba(3,6,15,.08)}
    .nav{display:flex;align-items:center;justify-content:space-between;max-width:1100px;margin:0 auto;padding:0 16px}
    .brand{font-weight:700;font-size:20px}
    nav a{color:#fff;margin-left:16px;text-decoration:none}
    nav a.active{text-decoration:underline}

    /* ========== Card & Grid ========== */
    .grid{display:grid;gap:16px}
    .grid.products{grid-template-columns:repeat(auto-fill,minmax(220px,1fr))}
    .card{background:#fff;padding:12px;border-radius:8px;box-shadow:0 1px 4px rgba(12,14,20,.06)}
    .card h3{font-size:16px;margin-bottom:8px}
    .price{font-weight:700;margin-top:8px}

    /* ========== Forms ========== */
    form{display:flex;flex-direction:column;gap:8px}
    input,textarea,select,button{padding:10px;border:1px solid #d6dbe8;border-radius:6px;font-size:14px}
    input:focus,textarea:focus,select:focus{outline:2px solid rgba(11,99,214,.12);border-color:rgba(11,99,214,.4)}
    .btn{background:#0b63d6;color:#fff;border:none;cursor:pointer;padding:10px;border-radius:6px}
    .btn.ghost{background:transparent;color:#0b63d6;border:1px solid rgba(11,99,214,.2)}
    .muted{color:#6b7280;font-size:13px}

    /* ========== Small helpers ========== */
    .row{display:flex;gap:8px;align-items:center}
    .space{height:16px}
    .right{margin-left:auto}
    .small{font-size:13px;color:#444}
    .alert{padding:10px;border-radius:6px;background:#ffefef;color:#900;border:1px solid rgba(153,0,0,.08)}
    .success{padding:10px;border-radius:6px;background:#eeffef;color:#0a660a;border:1px solid rgba(10,102,10,.08)}

    /* ========== Table ========== */
    table{width:100%;border-collapse:collapse}
    th,td{padding:8px;border-bottom:1px solid #eef2ff;text-align:left;font-size:14px}

    /* ========== Footer ========== */
    footer{margin-top:auto;padding:16px;text-align:center;color:#6b7280;font-size:13px}

    /* Responsive tweaks */
    @media (max-width:700px){
      .nav{padding:0 12px}
      nav a{margin-left:10px;font-size:14px}
      .grid.products{grid-template-columns:repeat(auto-fill,minmax(160px,1fr))}
    }
  </style>
</head>
<body>
  <header>
    <div class="nav">
      <div class="brand">kamal</div>
      <nav id="main-nav">
        <a href="#/" data-route="/" class="nav-link">Home</a>
        <a href="#/products" data-route="/products" class="nav-link">Products</a>
        <a href="#/support" data-route="/support" class="nav-link">Contact Us</a>
        <a href="#/about" data-route="/about" class="nav-link">About Us</a>
        <a href="#/wishlist" data-route="/wishlist" class="nav-link">Wishlist</a>
        <a href="#/orders" data-route="/orders" class="nav-link">Orders</a>
        <a href="#/reports" data-route="/reports" class="nav-link">Reports</a>
        <span id="auth-links" class="right">
          <!-- login/register or user will appear here -->
        </span>
      </nav>
    </div>
  </header>

  <main class="container" id="app">
    <!-- Content injected by JS -->
  </main>

  <footer>
    © <strong>kamal</strong> — Demo e-commerce (localStorage) · Built with HTML/CSS/JS
  </footer>

<script>
/* =========================
   Simple SPA Router + Data
   ========================= */

/* ---------- Utilities ---------- */
const $ = sel => document.querySelector(sel);
const qsAll = sel => Array.from(document.querySelectorAll(sel));
const uid = () => 'u' + Date.now() + Math.floor(Math.random()*1000);

/* ---------- LocalStorage Keys & Seed ---------- */
const LS = {
  USERS: 'kamal_users',
  CURRENT: 'kamal_current_user',
  PRODUCTS: 'kamal_products',
  TICKETS: 'kamal_tickets'
};

/* Seed sample products if not present */
const seedProducts = () => {
  if(!localStorage.getItem(LS.PRODUCTS)){
    const products = [
      { id:'p1', name: 'Wireless Headphones', price:1299, stock:10, desc:'Clear sound, long battery' },
      { id:'p2', name: 'Smart Watch', price:2499, stock:5, desc:'Fitness & notifications' },
      { id:'p3', name: 'Running Shoes', price:1999, stock:8, desc:'Comfortable & durable' },
      { id:'p4', name: 'Backpack', price:899, stock:20, desc:'Water-resistant, 20L' },
      { id:'p5', name: 'Bluetooth Speaker', price:699, stock:15, desc:'Portable, rich bass' }
    ];
    localStorage.setItem(LS.PRODUCTS, JSON.stringify(products));
  }
};

/* ---------- Data helpers ---------- */
const getUsers = () => JSON.parse(localStorage.getItem(LS.USERS) || '[]');
const saveUsers = u => localStorage.setItem(LS.USERS, JSON.stringify(u));
const getProducts = () => JSON.parse(localStorage.getItem(LS.PRODUCTS) || '[]');
const getCurrent = () => JSON.parse(localStorage.getItem(LS.CURRENT) || 'null');
const setCurrent = (user) => localStorage.setItem(LS.CURRENT, JSON.stringify(user));
const logout = () => { localStorage.removeItem(LS.CURRENT); renderNav(); navigateTo('/'); };

/* per-user storage keys */
const wishlistKey = (userId) => kamal_wishlist_${userId};
const ordersKey = (userId) => kamal_orders_${userId};
const reviewsKey = (productId) => kamal_reviews_${productId};

/* ---------- Auth functions ---------- */
function registerUser({name,email,password}){
  const users = getUsers();
  if(users.find(u => u.email.toLowerCase() === email.toLowerCase())){
    return {ok:false, msg:'Email already registered.'};
  }
  const newUser = { id: uid(), name, email: email.toLowerCase(), password /note: plaintext for demo only/ };
  users.push(newUser);
  saveUsers(users);
  setCurrent({id:newUser.id,name:newUser.name,email:newUser.email});
  return {ok:true, user:newUser};
}

function loginUser({email,password}){
  const users = getUsers();
  const user = users.find(u => u.email.toLowerCase() === email.toLowerCase() && u.password === password);
  if(!user) return {ok:false, msg:'Invalid credentials.'};
  setCurrent({id:user.id,name:user.name,email:user.email});
  return {ok:true, user};
}

/* ---------- Wishlist / Orders / Reviews / Tickets ---------- */
function getWishlist(){
  const cur = getCurrent(); if(!cur) return [];
  return JSON.parse(localStorage.getItem(wishlistKey(cur.id)) || '[]');
}
function toggleWishlist(productId){
  const cur = getCurrent(); if(!cur) { alert('Please login to use wishlist'); return; }
  const key = wishlistKey(cur.id);
  let list = JSON.parse(localStorage.getItem(key) || '[]');
  if(list.includes(productId)) list = list.filter(p=>p!==productId);
  else list.push(productId);
  localStorage.setItem(key, JSON.stringify(list));
  renderCurrentView();
  renderNav();
}

function getOrders(){
  const cur = getCurrent(); if(!cur) return [];
  return JSON.parse(localStorage.getItem(ordersKey(cur.id)) || '[]');
}
function placeOrder(items){
  const cur = getCurrent(); if(!cur) { alert('Please login to place order'); return false; }
  const orders = getOrders();
  const total = items.reduce((s,i)=>s + i.price*i.qty,0);
  const newOrder = { id: 'o' + Date.now(), items, total, status:'Processing', date: new Date().toISOString() };
  orders.unshift(newOrder);
  localStorage.setItem(ordersKey(cur.id), JSON.stringify(orders));
  return true;
}

/* Reviews: stored per-product */
function getReviews(productId){
  return JSON.parse(localStorage.getItem(reviewsKey(productId)) || '[]');
}
function addReview(productId, rating, comment){
  const cur = getCurrent(); if(!cur) { alert('Please login to post reviews'); return false; }
  const arr = getReviews(productId);
  arr.unshift({id: uid(), userId: cur.id, userName: cur.name, rating:+rating, comment, date:new Date().toISOString()});
  localStorage.setItem(reviewsKey(productId), JSON.stringify(arr));
  return true;
}

/* Support tickets */
function postTicket({name,email,subject,message}){
  const tickets = JSON.parse(localStorage.getItem(LS.TICKETS) || '[]');
  tickets.unshift({id: uid(), name, email, subject, message, status:'Open', date:new Date().toISOString()});
  localStorage.setItem(LS.TICKETS, JSON.stringify(tickets));
}

/* ---------- Navigation & Router ---------- */
const routes = {
  '/': renderHome,
  '/products': renderProducts,
  '/support': renderSupport,
  '/about': renderAbout,
  '/register': renderRegister,
  '/login': renderLogin,
  '/wishlist': renderWishlist,
  '/orders': renderOrders,
  '/product': renderProductDetails, // expects ?id=
  '/reports': renderReports
};

function navigateTo(path){
  location.hash = '#' + (path.startsWith('/') ? path : '/' + path);
}

function parseHash(){
  const hash = location.hash.slice(1) || '/';
  const [path, q] = hash.split('?');
  const query = {};
  if(q){
    q.split('&').forEach(pair=>{ const [k,v]=pair.split('='); query[k]=decodeURIComponent(v); });
  }
  return {path, query};
}

function router(){
  const {path, query} = parseHash();
  const handler = routes[path] || function(){ renderNotFound(); };
  handler(query);
  setActiveNav(path);
  renderNav();
}

window.addEventListener('hashchange', router);

/* ---------- Render helpers ---------- */
function setActiveNav(path){
  qsAll('.nav-link').forEach(a => {
    a.classList.toggle('active', a.getAttribute('data-route') === path);
  });
}
function renderNav(){
  const cur = getCurrent();
  const area = $('#auth-links');
  if(!area) return;
  if(cur){
    area.innerHTML = `
      <span class="small">Hi, ${escapeHtml(cur.name)}</span>
      <button class="btn" id="logoutBtn" style="margin-left:8px">Logout</button>
      <a href="#/register" style="margin-left:8px" class="btn ghost">Switch user</a>
    `;
    $('#logoutBtn').onclick = () => { logout(); };
  } else {
    area.innerHTML = `
      <a href="#/login" class="btn ghost" style="margin-left:8px">Login</a>
      <a href="#/register" class="btn" style="margin-left:8px">Register</a>
    `;
  }
}

/* Simple text-escape to avoid injection in demo */
function escapeHtml(s){ return String(s).replaceAll('&','&amp;').replaceAll('<','&lt;').replaceAll('>','&gt;'); }

/* ---------- Views ---------- */

function renderHome(){
  const products = getProducts();
  $('#app').innerHTML = `
    <div class="card">
      <h2>Welcome to <strong>kamal</strong></h2>
      <p class="muted">This is a demo e-commerce single-file app using <strong>HTML/CSS/JS</strong> and localStorage.</p>
      <div class="space"></div>
      <h3>Featured Products</h3>
      <div class="grid products" id="featured">
        ${products.slice(0,4).map(p=>`
          <div class="card">
            <h3>${escapeHtml(p.name)}</h3>
            <div class="small">${escapeHtml(p.desc)}</div>
            <div class="price">₹ ${p.price}</div>
            <div class="row" style="margin-top:8px">
              <button class="btn" onclick="navigateTo('/product?id=${p.id}')">View</button>
              <button class="btn ghost right" onclick="toggleWishlist('${p.id}')">${getCurrent() && getWishlist().includes(p.id) ? 'Remove ♥' : 'Wishlist ♥'}</button>
            </div>
          </div>
        `).join('')}
      </div>
    </div>
  `;
}

function renderProducts(){
  const products = getProducts();
  $('#app').innerHTML = `
    <div class="card">
      <h2>Products</h2>
      <p class="muted">Browse items and add to wishlist or place quick orders.</p>
      <div class="space"></div>
      <div class="grid products" id="product-list">
        ${products.map(p=>`
          <div class="card">
            <h3>${escapeHtml(p.name)}</h3>
            <div class="small">${escapeHtml(p.desc)}</div>
            <div class="price">₹ ${p.price}</div>
            <div class="row" style="margin-top:8px">
              <button class="btn" onclick="navigateTo('/product?id=${p.id}')">View</button>
              <button class="btn ghost right" onclick="toggleWishlist('${p.id}')">${getCurrent() && getWishlist().includes(p.id) ? 'Remove ♥' : 'Wishlist ♥'}</button>
            </div>
          </div>
        `).join('')}
      </div>
    </div>
  `;
}

function renderProductDetails(q){
  const id = q.id;
  const product = getProducts().find(p => p.id === id);
  if(!product){ renderNotFound(); return; }
  const reviews = getReviews(id);
  $('#app').innerHTML = `
    <div class="card">
      <div class="row">
        <h2>${escapeHtml(product.name)}</h2>
        <div class="right muted">Stock: ${product.stock}</div>
      </div>
      <div class="small">${escapeHtml(product.desc)}</div>
      <div class="price">₹ ${product.price}</div>
      <div class="space"></div>
      <div class="row">
        <input id="qty" type="number" min="1" value="1" style="width:100px" />
        <button class="btn" id="buyNow">Buy Now</button>
        <button class="btn ghost" id="wishBtn">${getCurrent() && getWishlist().includes(product.id) ? 'Remove from wishlist' : 'Add to wishlist'}</button>
      </div>

      <div class="space"></div>
      <h3>Reviews</h3>
      <div id="reviewsArea">
        ${reviews.length ? reviews.map(r=>`
          <div class="card" style="margin-bottom:8px">
            <div class="row">
              <strong>${escapeHtml(r.userName)}</strong>
              <div class="muted" style="margin-left:8px">${new Date(r.date).toLocaleString()}</div>
              <div class="right small">Rating: ${r.rating}/5</div>
            </div>
            <div class="small">${escapeHtml(r.comment)}</div>
          </div>
        `).join('') : '<div class="muted small">No reviews yet.</div>'}
      </div>

      <div class="space"></div>
      <div class="card">
        <h4>Write a review</h4>
        <div class="muted">You must be logged in to post a review.</div>
        <div style="margin-top:8px">
          <select id="rv_rating"><option value="5">5</option><option value="4">4</option><option value="3">3</option><option value="2">2</option><option value="1">1</option></select>
          <textarea id="rv_comment" rows="3" placeholder="Your comment..."></textarea>
          <div class="row">
            <button class="btn" id="rv_post">Post Review</button>
          </div>
        </div>
      </div>
    </div>
  `;

  $('#buyNow').onclick = () => {
    const qty = Math.max(1, parseInt($('#qty').value || 1));
    const item = { productId: product.id, name: product.name, price: product.price, qty };
    if(placeOrder([item])){
      alert('Order placed successfully (demo). Check Orders page.');
      navigateTo('/orders');
    }
  };
  $('#wishBtn').onclick = () => { toggleWishlist(product.id); };

  $('#rv_post').onclick = () => {
    const rating = $('#rv_rating').value;
    const comment = $('#rv_comment').value.trim();
    if(!comment) return alert('Enter comment');
    if(addReview(product.id, rating, comment)){
      alert('Review posted');
      renderProductDetails({id:product.id});
    }
  };
}

function renderRegister(){
  $('#app').innerHTML = `
    <div class="card" style="max-width:520px;margin:0 auto">
      <h2>Register</h2>
      <form id="regForm">
        <input id="reg_name" name="name" placeholder="Full name" required />
        <input id="reg_email" name="email" placeholder="Email" required />
        <input id="reg_password" name="password" type="password" placeholder="Password (min 6 chars)" required />
        <input id="reg_confirm" name="confirm" type="password" placeholder="Confirm password" required />
        <div class="row">
          <button class="btn" type="submit">Register</button>
          <button class="btn ghost" type="button" onclick="navigateTo('/login')">Already have account</button>
        </div>
      </form>
      <div class="space"></div>
      <div class="muted">Password stored in localStorage (demo only). Do NOT use real credentials here.</div>
    </div>
  `;
  $('#regForm').onsubmit = (e) => {
    e.preventDefault();
    const name = $('#reg_name').value.trim();
    const email = $('#reg_email').value.trim();
    const password = $('#reg_password').value;
    const confirm = $('#reg_confirm').value;
    const errs = [];
    if(!name) errs.push('Name required');
    if(!/^\S+@\S+\.\S+$/.test(email)) errs.push('Valid email required');
    if(password.length < 6) errs.push('Password must be at least 6 chars');
    if(password !== confirm) errs.push('Passwords do not match');
    if(errs.length){ alert(errs.join('\\n')); return; }
    const res = registerUser({name,email,password});
    if(!res.ok) { alert(res.msg); return; }
    alert('Registered and logged in');
    renderNav();
    navigateTo('/');
  };
}

function renderLogin(){
  $('#app').innerHTML = `
    <div class="card" style="max-width:420px;margin:0 auto">
      <h2>Login</h2>
      <form id="loginForm">
        <input id="login_email" name="email" placeholder="Email" required />
        <input id="login_password" name="password" type="password" placeholder="Password" required />
        <div class="row">
          <button class="btn" type="submit">Login</button>
          <button class="btn ghost" type="button" onclick="navigateTo('/register')">Register</button>
        </div>
        <div class="space"></div>
        <div class="muted">Demo users: register a new user to test.</div>
      </form>
    </div>
  `;
  $('#loginForm').onsubmit = (e) => {
    e.preventDefault();
    const email = $('#login_email').value.trim();
    const password = $('#login_password').value;
    if(!email || !password) return alert('Enter email and password');
    const res = loginUser({email,password});
    if(!res.ok){ alert(res.msg); return; }
    alert('Login success');
    renderNav();
    navigateTo('/');
  };
}

function renderWishlist(){
  const cur = getCurrent();
  if(!cur){
    $('#app').innerHTML = <div class="card"><h3>Please login to see your wishlist</h3></div>; return;
  }
  const list = getWishlist();
  const products = getProducts().filter(p => list.includes(p.id));
  $('#app').innerHTML = `
    <div class="card">
      <h2>${escapeHtml(cur.name)}'s Wishlist</h2>
      <div class="space"></div>
      ${products.length ? `
        <div class="grid products">
          ${products.map(p=>`
            <div class="card">
              <h3>${escapeHtml(p.name)}</h3>
              <div class="small">${escapeHtml(p.desc)}</div>
              <div class="price">₹ ${p.price}</div>
              <div class="row" style="margin-top:8px">
                <button class="btn" onclick="navigateTo('/product?id=${p.id}')">View</button>
                <button class="btn ghost right" onclick="toggleWishlist('${p.id}')">Remove</button>
              </div>
            </div>
          `).join('')}
        </div>
      ` : <div class="muted small">No items in wishlist.</div>}
    </div>
  `;
}

function renderOrders(){
  const cur = getCurrent();
  if(!cur){
    $('#app').innerHTML = <div class="card"><h3>Please login to view your orders</h3></div>; return;
  }
  const orders = getOrders();
  $('#app').innerHTML = `
    <div class="card">
      <h2>Orders — ${escapeHtml(cur.name)}</h2>
      <div class="space"></div>
      ${orders.length ? `
        <div>
          ${orders.map(o=>`
            <div class="card" style="margin-bottom:12px">
              <div class="row">
                <strong>Order ${o.id}</strong>
                <div class="muted">${new Date(o.date).toLocaleString()}</div>
                <div class="right small">Status: ${escapeHtml(o.status)}</div>
              </div>
              <table>
                <thead><tr><th>Item</th><th>Qty</th><th>Price</th></tr></thead>
                <tbody>
                  ${o.items.map(it=>`<tr><td>${escapeHtml(it.name)}</t