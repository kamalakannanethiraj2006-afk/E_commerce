<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>ShopLite</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root { --bg:#0f172a; --card:#111827; --muted:#64748b; --text:#e5e7eb; --accent:#22c55e; --danger:#ef4444; }
    * { box-sizing: border-box }
    body { margin:0; font-family: system-ui, -apple-system, Segoe UI, Roboto, sans-serif; background:#0b1220; color:var(--text) }
    a { color:inherit; text-decoration:none }
    .container { max-width:1100px; margin:0 auto; padding:16px }
    /* Nav */
    nav { position:sticky; top:0; backdrop-filter: blur(6px); background:rgba(9,13,22,0.7); border-bottom:1px solid #1f2937; z-index:10 }
    .nav-inner { display:flex; align-items:center; gap:16px; padding:12px 16px }
    .logo { font-weight:700; letter-spacing:.4px }
    .menu { display:flex; flex-wrap:wrap; gap:12px; margin-left:auto }
    .menu a { padding:8px 10px; border-radius:8px; }
    .menu a.active, .menu a:hover { background:#172032 }
    .auth { display:flex; gap:8px; margin-left:16px }
    .btn { padding:8px 12px; border:1px solid #334155; border-radius:8px; background:#121a2a; color:var(--text); cursor:pointer }
    .btn.primary { border-color:#1a2e22; background:#132318 }
    .btn.danger { border-color:#3a1a1a; background:#221212 }
    .btn:hover { filter:brightness(1.1) }
    /* Layout */
    section { padding:24px 16px }
    h2 { margin:0 0 12px 0; font-size:22px }
    p.muted { color:var(--muted) }
    /* Cards & grids */
    .grid { display:grid; grid-template-columns: repeat(auto-fill, minmax(240px, 1fr)); gap:14px }
    .card { background:#0e1624; border:1px solid #1f2937; border-radius:12px; padding:14px }
    .row { display:flex; gap:10px; align-items:center; flex-wrap:wrap }
    /* Forms */
    form { display:grid; gap:10px; max-width:450px }
    input, select, textarea { width:100%; padding:10px; border-radius:8px; border:1px solid #334155; background:#0b1322; color:var(--text) }
    label { font-size:14px; color:#cbd5e1 }
    .error { color:var(--danger); font-size:13px; margin-top:-6px }
    .success { color:var(--accent); font-size:13px }
    .inline { display:flex; gap:10px }
    .chip { display:inline-block; padding:4px 8px; border-radius:999px; background:#152036; color:#cbd5e1; font-size:12px }
    img.product { width:100%; height:140px; object-fit:cover; border-radius:8px; background:#0b1220 }
    .table { width:100%; border-collapse: collapse; }
    .table th, .table td { border:1px solid #1f2937; padding:8px; text-align:left }
    .table th { background:#131b2a }
    /* Footer */
    footer { padding:20px; border-top:1px solid #1f2937; color:#94a3b8; text-align:center }
    /* Responsive tweaks */
    @media (max-width:600px) { .menu { gap:6px } .nav-inner { flex-wrap:wrap } }
  </style>
</head>
<body>
  <nav>
    <div class="nav-inner container">
      <div class="logo">ShopLite</div>
      <div class="menu" id="menu">
        <a href="#/" data-route="/">Home</a>
        <a href="#/products" data-route="/products">Product items</a>
        <a href="#/about" data-route="/about">About Us</a>
        <a href="#/contact" data-route="/contact">Contact Us</a>
        <a href="#/orders" data-route="/orders">Orders</a>
        <a href="#/wishlist" data-route="/wishlist">Wishlist</a>
        <a href="#/reviews" data-route="/reviews">Comments & reviews</a>
        <a href="#/support" data-route="/support">Customer Care</a>
        <a href="#/reports" data-route="/reports">Reporting</a>
      </div>
      <div class="auth" id="authArea"></div>
    </div>
  </nav>

  <main class="container" id="app"></main>

  <footer>
    © ShopLite — A vanilla JS demo. Data stored in your browser.
  </footer>

  <script>
    // ---------- Utilities & Storage ----------
    const LS = {
      get(key, def) { try { return JSON.parse(localStorage.getItem(key)) ?? def; } catch { return def; } },
      set(key, val) { localStorage.setItem(key, JSON.stringify(val)); }
    };
    const state = {
      user: LS.get('user', null),
      products: LS.get('products', null),
      orders: LS.get('orders', []),
      wishlist: LS.get('wishlist', []),
      reviews: LS.get('reviews', []),
      tickets: LS.get('tickets', [])
    };
    function saveState() {
      LS.set('user', state.user);
      LS.set('orders', state.orders);
      LS.set('wishlist', state.wishlist);
      LS.set('reviews', state.reviews);
      LS.set('tickets', state.tickets);
      LS.set('products', state.products);
    }
    function ensureSeed() {
      if (!state.products) {
        state.products = [
          { id:'p1', title:'Wireless Headphones', price:1999, stock:12, image:'https://picsum.photos/seed/head/400/240', desc:'Comfortable over-ear with 30h battery.' },
          { id:'p2', title:'Smart Watch', price:2999, stock:8, image:'https://picsum.photos/seed/watch/400/240', desc:'Fitness tracking and notifications.' },
          { id:'p3', title:'Gaming Mouse', price:1499, stock:20, image:'https://picsum.photos/seed/mouse/400/240', desc:'RGB, 6 buttons, 12k DPI.' },
          { id:'p4', title:'Bluetooth Speaker', price:1799, stock:10, image:'https://picsum.photos/seed/speaker/400/240', desc:'Portable, deep bass, IPX5.' },
          { id:'p5', title:'USB‑C Charger', price:899, stock:50, image:'https://picsum.photos/seed/charger/400/240', desc:'65W PD fast charging.' }
        ];
        saveState();
      }
    }
    ensureSeed();

    // ---------- Auth ----------
    function hash(str) { // simple demo hash
      let h = 0; for (let i=0;i<str.length;i++) h = ((h<<5)-h)+str.charCodeAt(i); return String(h);
    }
    function registerUser({ name, email, password, phone }) {
      const users = LS.get('users', []);
      if (users.find(u => u.email===email)) throw new Error('Email already registered');
      const user = { id: 'u'+(users.length+1), name, email, phone, passHash: hash(password) };
      users.push(user); LS.set('users', users);
      return user;
    }
    function loginUser({ email, password }) {
      const users = LS.get('users', []);
      const u = users.find(x => x.email===email);
      if (!u || u.passHash !== hash(password)) throw new Error('Invalid credentials');
      state.user = { id:u.id, name:u.name, email:u.email };
      saveState();
      renderAuth();
    }
    function logout() { state.user = null; saveState(); renderAuth(); routeTo('#/'); }

    // ---------- Validation ----------
    const validators = {
      name(v){ if(!v || v.trim().length<2) return 'Name must be at least 2 characters'; },
      email(v){ const re=/^[^\s@]+@[^\s@]+\.[^\s@]+$/; if(!re.test(v)) return 'Enter a valid email'; },
      password(v){
        if(!v || v.length<8) return 'Password must be at least 8 characters';
        if(!/[A-Z]/.test(v)) return 'Include at least 1 uppercase letter';
        if(!/[a-z]/.test(v)) return 'Include at least 1 lowercase letter';
        if(!/[0-9]/.test(v)) return 'Include at least 1 number';
        if(!/[^A-Za-z0-9]/.test(v)) return 'Include at least 1 special character';
      },
      confirm(p,c){ if(p!==c) return 'Passwords do not match'; },
      phone(v){ if(!/^\d{10}$/.test(v)) return 'Enter a 10-digit phone number'; },
    };

    // ---------- Router ----------
    const routes = {};
    function route(path, view){ routes[path]=view; }
    function getPath(){ const h = location.hash.replace('#',''); return h || '/'; }
    function routeTo(h){ location.hash = h; }
    function renderMenuActive(){
      const current = getPath();
      document.querySelectorAll('#menu a').forEach(a=>{
        a.classList.toggle('active', a.getAttribute('data-route')===current);
      });
    }
    window.addEventListener('hashchange', () => { renderMenuActive(); render(); });

    // ---------- Views ----------
    const app = document.getElementById('app');

    route('/', () => `
      <section>
        <h2>Welcome to ShopLite</h2>
        <p class="muted">Browse products, add to wishlist, leave reviews, and reach customer care. Orders and reports require login.</p>
        <div class="grid">
          ${state.products.map(p => `
            <div class="card">
              <img class="product" src="${p.image}" alt="${p.title}">
              <p><strong>${p.title}</strong></p>
              <p class="muted">₹${p.price}</p>
              <div class="row">
                <button class="btn" onclick="addToWishlist('${p.id}','${p.title}',${p.price})">Add to wishlist</button>
                <button class="btn primary" onclick="routeTo('#/products')">View products</button>
              </div>
            </div>
          `).join('')}
        </div>
      </section>
    `);

    route('/products', () => `
      <section>
        <h2>Product items</h2>
        <div class="grid">
          ${state.products.map(p => `
            <div class="card">
              <img class="product" src="${p.image}" alt="${p.title}">
              <p><strong>${p.title}</strong></p>
              <p>${p.desc}</p>
              <div class="row">
                <span class="chip">₹${p.price}</span>
                <span class="chip">Stock: ${p.stock}</span>
              </div>
              <div class="row">
                <button class="btn" onclick="addToWishlist('${p.id}','${p.title}',${p.price})">Wishlist</button>
                <button class="btn primary" onclick="placeOrder('${p.id}')">Order now</button>
              </div>
            </div>
          `).join('')}
        </div>
      </section>
    `);

    route('/about', () => `
      <section>
        <h2>About Us</h2>
        <p>ShopLite is a demo e‑commerce portal built entirely with HTML, CSS, and JavaScript (no frameworks).</p>
        <p class="muted">This showcases routing, validation, and feature pages using localStorage.</p>
      </section>
    `);

    route('/contact', () => `
      <section>
        <h2>Contact Us</h2>
        <p><strong>Email:</strong> support@shoplite.example</p>
        <p><strong>Phone:</strong> +91 80 1234 5678</p>
        <p class="muted">For issues, raise a ticket under Customer Care.</p>
      </section>
    `);

    route('/login', () => `
      <section>
        <h2>Login</h2>
        <form id="loginForm">
          <div>
            <label>Email</label>
            <input name="email" placeholder="you@example.com" />
            <div class="error" data-err="email"></div>
          </div>
          <div>
            <label>Password</label>
            <input type="password" name="password" placeholder="••••••••" />
            <div class="error" data-err="password"></div>
          </div>
          <button class="btn primary" type="submit">Login</button>
          <p class="muted">No account? <a href="#/register">Register</a></p>
          <div class="error" data-err="form"></div>
        </form>
      </section>
    `);

    route('/register', () => `
      <section>
        <h2>Create account</h2>
        <form id="registerForm">
          <div>
            <label>Full name</label>
            <input name="name" placeholder="Kamalakannan" />
            <div class="error" data-err="name"></div>
          </div>
          <div>
            <label>Email</label>
            <input name="email" placeholder="you@example.com" />
            <div class="error" data-err="email"></div>
          </div>
          <div>
            <label>Password</label>
            <input type="password" name="password" placeholder="Min 8 chars, A/a/0/special" />
            <div class="error" data-err="password"></div>
          </div>
          <div>
            <label>Confirm password</label>
            <input type="password" name="confirm" placeholder="Re-enter password" />
            <div class="error" data-err="confirm"></div>
          </div>
          <div>
            <label>Phone</label>
            <input name="phone" placeholder="10-digit" />
            <div class="error" data-err="phone"></div>
          </div>
          <button class="btn primary" type="submit">Register</button>
          <div class="success" data-ok="form"></div>
          <div class="error" data-err="form"></div>
        </form>
      </section>
    `);

    route('/orders', () => {
      if (!state.user) return gate('Orders');
      return `
        <section>
          <h2>Your orders</h2>
          ${state.orders.length===0 ? '<p class="muted">No orders yet. Go to Product items to place one.</p>' : ''}
          <div class="grid">
            ${state.orders.map(o => `
              <div class="card">
                <p><strong>Order:</strong> ${o.id}</p>
                <p><strong>Status:</strong> ${o.status}</p>
                <p><strong>Total:</strong> ₹${o.total}</p>
                <div>
                  ${o.items.map(i => `<div>${i.title} — Qty: ${i.qty}</div>`).join('')}
                </div>
              </div>
            `).join('')}
          </div>
        </section>
      `;
    });

    route('/wishlist', () => {
      if (!state.user) return gate('Wishlist');
      return `
        <section>
          <h2>Your wishlist</h2>
          ${state.wishlist.length===0 ? '<p class="muted">Wishlist is empty. Add items from Home or Product items.</p>' : ''}
          <div class="grid">
            ${state.wishlist.map(w => `
              <div class="card">
                <p><strong>${w.title}</strong></p>
                <p class="muted">₹${w.price}</p>
                <div class="row">
                  <button class="btn primary" onclick="placeOrder('${w.productId}')">Buy</button>
                  <button class="btn danger" onclick="removeWishlist('${w.id}')">Remove</button>
                </div>
              </div>
            `).join('')}
          </div>
        </section>
      `;
    });

    route('/reviews', () => `
      <section>
        <h2>Comments & reviews</h2>
        <form id="reviewForm">
          <div>
            <label>Product</label>
            <select name="productId">
              ${state.products.map(p => `<option value="${p.id}">${p.title}</option>`).join('')}
            </select>
          </div>
          <div class="inline">
            <div style="flex:1">
              <label>Rating</label>
              <select name="rating">
                ${[1,2,3,4,5].map(r=>`<option value="${r}">${r}</option>`).join('')}
              </select>
            </div>
            <div style="flex:3">
              <label>Comment</label>
              <input name="comment" placeholder="Share your thoughts" />
            </div>
          </div>
          <button class="btn primary" type="submit">Submit review</button>
        </form>
        <div style="margin-top:14px">
          ${state.reviews.length===0 ? '<p class="muted">No reviews yet.</p>' : ''}
          <div class="grid">
            ${state.reviews.map(r => `
              <div class="card">
                <p><strong>${r.productTitle}</strong></p>
                <p class="chip">Rating: ${r.rating}/5</p>
                <p>${r.comment}</p>
              </div>
            `).join('')}
          </div>
        </div>
      </section>
    `);

    route('/support', () => `
      <section>
        <h2>Customer Care</h2>
        <form id="ticketForm">
          <div>
            <label>Subject</label>
            <input name="subject" placeholder="Issue subject" />
          </div>
          <div>
            <label>Message</label>
            <textarea name="message" placeholder="Describe your issue"></textarea>
          </div>
          <button class="btn primary" type="submit">Create ticket</button>
        </form>
        <div style="margin-top:14px">
          ${state.tickets.length===0 ? '<p class="muted">No tickets submitted.</p>' : ''}
          <div class="grid">
            ${state.tickets.map(t => `
              <div class="card">
                <p><strong>${t.subject}</strong></p>
                <p class="chip">Status: ${t.status}</p>
                <p>${t.message}</p>
              </div>
            `).join('')}
          </div>
        </div>
      </section>
    `);

    route('/reports', () => {
      if (!state.user) return gate('Reporting');
      const totalOrders = state.orders.length;
      const totalRevenue = state.orders.reduce((s,o)=>s+o.total,0);
      const counts = {};
      state.orders.forEach(o => o.items.forEach(i => counts[i.title]=(counts[i.title]||0)+i.qty));
      const topProduct = Object.keys(counts).sort((a,b)=>counts[b]-counts[a])[0];
      const avgRating = state.reviews.length ? (state.reviews.reduce((s,r)=>s+Number(r.rating),0)/state.reviews.length).toFixed(2) : '0.00';
      return `
        <section>
          <h2>Reporting</h2>
          <div class="grid">
            <div class="card">
              <p><strong>Total orders:</strong> ${totalOrders}</p>
              <p><strong>Total revenue:</strong> ₹${totalRevenue}</p>
            </div>
            <div class="card">
              <p><strong>Top product:</strong> ${topProduct || '—'}</p>
              <p><strong>Units sold:</strong> ${topProduct ? counts[topProduct] : 0}</p>
            </div>
            <div class="card">
              <p><strong>Average rating:</strong> ${avgRating}</p>
            </div>
          </div>
        </section>
      `;
    });

    function gate(name){
      return `
        <section>
          <h2>${name}</h2>
          <p class="muted">Please login to view ${name.toLowerCase()}.</p>
          <div class="row">
            <a class="btn primary" href="#/login">Login</a>
            <a class="btn" href="#/register">Register</a>
          </div>
        </section>
      `;
    }

    // ---------- Actions ----------
    function addToWishlist(productId, title, price){
      if (!state.user) { routeTo('#/login'); return; }
      const id = 'w'+(state.wishlist.length+1);
      state.wishlist.push({ id, productId, title, price });
      saveState(); render();
    }
    function removeWishlist(id){
      state.wishlist = state.wishlist.filter(w => w.id!==id);
      saveState(); render();
    }
    function placeOrder(productId){
      if (!state.user) { routeTo('#/login'); return; }
      const p = state.products.find(x=>x.id===productId);
      if (!p) return alert('Product not found');
      const order = {
        id: 'o'+(state.orders.length+1),
        status: 'PLACED',
        items: [{ productId: p.id, title: p.title, price: p.price, qty: 1 }],
        total: p.price
      };
      state.orders.unshift(order);
      // remove from wishlist if present
      state.wishlist = state.wishlist.filter(w => w.productId!==productId);
      saveState(); routeTo('#/orders');
    }

    // ---------- Event wiring after render ----------
    function wireForms(){
      const reg = document.getElementById('registerForm');
      if (reg){
        reg.addEventListener('submit', (e)=>{
          e.preventDefault();
          const fd = new FormData(reg);
          const name = fd.get('name')?.trim();
          const email = fd.get('email')?.trim();
          const password = fd.get('password') || '';
          const confirm = fd.get('confirm') || '';
          const phone = fd.get('phone')?.trim();

          const errs = {
            name: validators.name(name),
            email: validators.email(email),
            password: validators.password(password),
            confirm: validators.confirm(password, confirm),
            phone: validators.phone(phone),
          };
          reg.querySelectorAll('.error').forEach(el=>el.textContent='');
          let hasErr = false;
          Object.entries(errs).forEach(([k,v])=>{
            if (v){ hasErr=true; const el = reg.querySelector(`[data-err="${k}"]`); if(el) el.textContent = v; }
          });
          const okEl = reg.querySelector('[data-ok="form"]');
          const formErr = reg.querySelector('[data-err="form"]');
          okEl.textContent=''; formErr.textContent='';
          if (hasErr) return;

          try {
            registerUser({ name, email, password, phone });
            okEl.textContent = 'Registered successfully. You can now login.';
          } catch (err) {
            formErr.textContent = err.message || 'Registration failed';
          }
        });
      }

      const login = document.getElementById('loginForm');
      if (login){
        login.addEventListener('submit', (e)=>{
          e.preventDefault();
          const fd = new FormData(login);
          const email = fd.get('email')?.trim();
          const password = fd.get('password') || '';
          login.querySelector('[data-err="email"]').textContent = validators.email(email) || '';
          login.querySelector('[data-err="password"]').textContent = !password ? 'Password is required' : '';
          const formErr = login.querySelector('[data-err="form"]'); formErr.textContent='';
          const hasErr = validators.email(email) || !password;
          if (hasErr) return;
          try {
            loginUser({ email, password });
            routeTo('#/orders');
          } catch (err) {
            formErr.textContent = err.message || 'Login failed';
          }
        });
      }

      const rev = document.getElementById('reviewForm');
      if (rev){
        rev.addEventListener('submit', (e)=>{
          e.preventDefault();
          const fd = new FormData(rev);
          const productId = fd.get('productId');
          const rating = Number(fd.get('rating'));
          const comment = (fd.get('comment')||'').trim();
          const p = state.products.find(x=>x.id===productId);
          state.reviews.unshift({
            id:'r'+(state.reviews.length+1),
            productId, productTitle: p?.title || productId,
            rating, comment
          });
          saveState(); render();
        });
      }

      const ticket = document.getElementById('ticketForm');
      if (ticket){
        ticket.addEventListener('submit', (e)=>{
          e.preventDefault();
          const fd = new FormData(ticket);
          const subject = (fd.get('subject')||'').trim();
          const message = (fd.get('message')||'').trim();
          if (!subject || !message){
            alert('Subject and message are required');
            return;
          }
          state.tickets.unshift({ id:'t'+(state.tickets.length+1), subject, message, status:'OPEN' });
          saveState(); render();
        });
      }
    }

    // ---------- Auth area ----------
    function renderAuth(){
      const el = document.getElementById('authArea');
      if (!state.user) {
        el.innerHTML = `<a class="btn" href="#/login">Login</a><a class="btn primary" href="#/register">Register</a>`;
      } else {
        el.innerHTML = `<span class="chip">Hello, ${state.user.name}</span><button class="btn danger" onclick="logout()">Logout</button>`;
      }
    }

    // ---------- Render ----------
    function render(){
      const view = routes[getPath()] || routes['/'];
      app.innerHTML = view();
      wireForms();
    }

    // Initial render
    renderAuth();
    renderMenuActive();
    render();
  </script>
</body>
</html>
